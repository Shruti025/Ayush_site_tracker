<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>100-Day Challenge Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    button { padding: 10px 20px; margin-top: 20px; font-size: 16px; cursor: pointer; }
    #progress { margin-top: 20px; font-size: 18px; }
    #milestonePopup {
      display: none; position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%); background: white; border: 2px solid #333;
      padding: 20px; z-index: 1000; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    #confettiCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
  </style>
</head>
<body>
  <h1>💪 100-Day Challenge Tracker</h1>
  <button onclick="markToday()">Mark Today ✅</button>
  <div id="progress">Loading progress...</div>

  <!-- Milestone Popup -->
  <div id="milestonePopup">
    <h2>Hey! you reached a milestone!</h2>
    <p id="milestoneMessage"></p>
    <button onclick="closePopup()">YAY!</button>
  </div>

  <canvas id="confettiCanvas"></canvas>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc }
      from "https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore.js";

    // Your Firebase config (replace with yours!)
    const firebaseConfig = {
      apiKey: "YOUR-API-KEY",
      authDomain: "YOUR-PROJECT.firebaseapp.com",
      projectId: "YOUR-PROJECT-ID",
      storageBucket: "YOUR-PROJECT.appspot.com",
      messagingSenderId: "YOUR-SENDER-ID",
      appId: "YOUR-APP-ID",
      measurementId: "YOUR-MEASUREMENT-ID"
    };

    // Init Firebase + Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const progressEl = document.getElementById("progress");
    const popup = document.getElementById("milestonePopup");
    const popupMsg = document.getElementById("milestoneMessage");
    const confettiCanvas = document.getElementById("confettiCanvas");
    const ctx = confettiCanvas.getContext("2d");
    let confetti = [];

    // Fetch saved progress
    async function loadProgress() {
      const ref = doc(db, "progress", "user1");
      const snap = await getDoc(ref);
      let data = snap.exists() ? snap.data() : { count: 0, days: {} };
      progressEl.textContent = `Progress: ${data.count}/100 days`;
      return data;
    }

    // Mark today’s entry
    async function markToday() {
      const today = new Date().toISOString().split("T")[0]; // YYYY-MM-DD
      const ref = doc(db, "progress", "user1");

      let data = await loadProgress();

      if (data.days[today]) {
        alert("You’ve already marked today!");
        return;
      }

      data.days[today] = true;
      data.count = (data.count || 0) + 1;

      await setDoc(ref, data);
      progressEl.textContent = `Progress: ${data.count}/100 days`;

      checkMilestone(data.count);
    }

    // Milestones
    function checkMilestone(count) {
      let message = "";
      if (count === 16) message = "hey its 16 🎉";
      if (count === 58) message = "yoo that's crazy 🚀";
      if (count === 100) message = "finally done 🏆";

      if (message) {
        popupMsg.textContent = message;
        popup.style.display = "block";
        startConfetti();
      }
    }

    function closePopup() {
      popup.style.display = "none";
      stopConfetti();
    }

    // Confetti
    function startConfetti() {
      confetti = Array.from({ length: 200 }, () => ({
        x: Math.random() * confettiCanvas.width,
        y: Math.random() * confettiCanvas.height - confettiCanvas.height,
        r: Math.random() * 6 + 4,
        d: Math.random() * 10 + 10,
        color: `hsl(${Math.random() * 360}, 100%, 50%)`,
        tilt: Math.random() * 10 - 10,
        tiltAngleIncremental: Math.random() * 0.07 + 0.05,
        tiltAngle: 0
      }));
      requestAnimationFrame(drawConfetti);
    }

    function drawConfetti() {
      ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
      confetti.forEach(c => {
        ctx.beginPath();
        ctx.lineWidth = c.r / 2;
        ctx.strokeStyle = c.color;
        ctx.moveTo(c.x + c.tilt + c.r / 4, c.y);
        ctx.lineTo(c.x + c.tilt, c.y + c.tilt + c.r / 4);
        ctx.stroke();
      });
      updateConfetti();
      requestAnimationFrame(drawConfetti);
    }

    function updateConfetti() {
      confetti.forEach(c => {
        c.tiltAngle += c.tiltAngleIncremental;
        c.y += (Math.cos(c.d) + 3 + c.r / 2) / 2;
        c.x += Math.sin(c.d);
        c.tilt = Math.sin(c.tiltAngle - c.r / 2) * 15;
        if (c.y > confettiCanvas.height) {
          c.y = -10; c.x = Math.random() * confettiCanvas.width;
        }
      });
    }

    function stopConfetti() { confetti = []; }

    // Resize canvas
    function resizeCanvas() {
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    // Load initial progress
    loadProgress();
  </script>
</body>
</html>
